<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/favicon.ico">
    <link rel="icon" type="image/png" href="./assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Traveler</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700|Source+Sans+Pro:400,700"
        rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
        integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <!-- Main CSS -->
    <link href="./assets/css/main.css" rel="stylesheet" />
    <script src="./assets/js/api.js"></script>
</head>

<body>

    <nav class="topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
        <div class="container">
            <a class="navbar-brand" href="./index.html"><strong>Traveler</strong></a>
            <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarColor02"
                aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="navbar-collapse collapse" id="navbarColor02">
                <ul class="navbar-nav mr-auto d-flex align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="./index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./recommend.html">Recommend</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./diary.html">Journey Diary</a>
                    </li>
                </ul>
                <ul class="navbar-nav ml-auto d-flex align-items-center">

                    <li class="nav-item highlight mx-3">
                        <a class="nav-link" href="./login.html">Sign in</a>
                    </li>
                    <li class="nav-item highlight">
                        <a class="nav-link" href="./register.html">Sign up</a>
                    </li>
                </ul>
                <a class="nav-link" href="./user_info.html">
                    <img class="rounded-circle shadow" src="assets/img/demo/avatar2.jpg" width="20">
                    <span id="Name">BUPT</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-5 mb-5">
        <div class="row">
            <div class="col-md-8" id="searchItem">
                <h5 class="font-weight-bold spanborder"><span>Search</span></h5>

            </div>
            <div class="col-md-4 pl-4">
                <div class="sticky-top">
                    <h5 class="font-weight-bold spanborder"><span>Popular in Science</span></h5>
                    <ol class="list-featured">
                        <li>
                            <span>
                                <h6 class="font-weight-bold">
                                    <a href="diary_show.html" class="text-dark" id="article-title-1">Did Supernovae Kill
                                        Off Large
                                        Ocean Animals?</a>
                                </h6>
                                <p class="text-muted" id="article-author-1">xiaosan in TRAVELER</p>
                            </span>
                        </li>
                        <li>
                            <span>
                                <h6 class="font-weight-bold">
                                    <a href="diary_show.html" class="text-dark" id="article-title-2">Humans Reversing
                                        Climate Clock:
                                        50 Million Years</a>
                                </h6>
                                <p class="text-muted" id="article-author-2">xiaosan in TRAVELER</p>
                            </span>
                        </li>
                        <li>
                            <span>
                                <h6 class="font-weight-bold">
                                    <a href="diary_show.html" class="text-dark" id="article-title-3">Unprecedented Views
                                        of the Birth
                                        of Planets</a>
                                </h6>
                                <p class="text-muted" id="article-author-3">xiaosan in TRAVELER</p>
                            </span>
                        </li>
                        <li>
                            <span>
                                <h6 class="font-weight-bold">
                                    <a href="diary_show.html" class="text-dark" id="article-title-4">Effective New
                                        Target for
                                        Mood-Boosting Brain Stimulation Found</a>
                                </h6>
                                <p class="text-muted" id="article-author-4">xiaosan in TRAVELER</p>
                            </span>
                        </li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <div class="container pt-4 pb-4">
        <div class="border p-5 bg-lightblue">
            <div class="row justify-content-between">
                <div class="col-md-6">
                    <h5 class="font-weight-bold secondfont">Become a member</h5>
                    Get the latest news right in your inbox. It's free and you can unsubscribe at any time. We hate spam
                    as much as we do, so we never spam!
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="First name">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Last name">
                        </div>
                        <div class="col-md-12 mt-3">
                            <button type="submit" class="btn btn-success btn-block">Subscribe</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="container mt-5">
        <footer class="bg-white border-top p-3 text-muted small">
            <div class="row align-items-center justify-content-between">
                <div>
                    <span class="navbar-brand mr-2"><strong>Traveler</strong></span> Copyright &copy;
                    <script>document.write(new Date().getFullYear())</script>
                    . All rights reserved.
                </div>
                <div>
                    Made with <a target="_blank" class="text-secondary font-weight-bold" href="./login.html"> Theme</a>
                    by
                    Jspao.com.
                </div>
            </div>
        </footer>
    </div>

    <script src="./assets/js/vendor/jquery.min.js"></script>
    <script src="./assets/js/vendor/popper.min.js"></script>
    <script src="./assets/js/vendor/bootstrap.min.js"></script>
    <script src="./assets/js/functions.js"></script>
    <script>
        function getQueryStringArgs() {
            var qs = (location.search.length > 0 ? location.search.substring(1) : ""),
                args = {},
                items = qs.length ? qs.split("&") : [],
                item = null,
                name = null,
                value = null,
                i = 0,
                len = items.length;

            for (i = 0; i < len; i++) {
                item = items[i].split("=");

                // decodeURIComponent解码
                name = decodeURIComponent(item[0]);
                value = decodeURIComponent(item[1]);

                if (name.length) {
                    args[name] = value;
                }
            }

            return args;
        }
        let query = getQueryStringArgs();
        let search = decodeURIComponent(query.search);
        console.log(search)
        window.onload = function () {
            $.ajax({
                url: `${baseUrl}/api/map/search?q=${search}`, // 存放即将与后端通信的接口 ****
                type: 'GET', // 请求类型 POST (data) GET (query params) PUT (data) DELETE 
                success: function (res) {
                    console.log(res)
                    let html = ''
                    $.each(res, function (index, item) {
                        console.log(index, item)
                        var img_path = item.Img;

                        // 确保 img_path 是字符串类型
                        if (typeof img_path === "string" && img_path.startsWith(",data/src/")) {
                            img_path = img_path.replace(",data/src/", "./");
                        }

                        console.log(img_path);

                        html += `<div class="mb-3 d-flex justify-content-between">
                <div class="pr-3">
                    <h2 class="mb-1 h4 font-weight-bold">
                        <a class="text-dark" href="recommend_show.html?id=${item.Id}">${item.Name}</a>
                    </h2>
                    <p>
                        ${item.Summary}
                    </p>
                    <div class="card-text text-muted small">
                        ${item.Tags}
                    </div>
                    <small class="text-muted">${item.rate}</small>
                </div>
                <img height="120" src="${img_path}">
            </div>`
                    })
                    $('#searchItem').append(html)
                },
                error: function (error) {
                    console.error('Error:', error)
                }
            })
            $.ajax({
                url: `${baseUrl}/api/article/recommend`,
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // Check if we have at least 4 articles
                    if (data.length >= 4) {
                        // Update the HTML with the fetched data
                        for (let i = 0; i < 4; i++) {
                            $(`#article-title-${i + 1}`).text(data[i].title);
                            $(`#article-title-${i + 1}`).attr('href', `diary_show.html?id=${data[i].id}`);
                            $(`#article-author-${i + 1}`).text(data[i].author);
                        }
                    } else {
                        console.error('Not enough articles returned from API');
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching data:', error);
                }
            });
        }
    </script>
</body>

</html>